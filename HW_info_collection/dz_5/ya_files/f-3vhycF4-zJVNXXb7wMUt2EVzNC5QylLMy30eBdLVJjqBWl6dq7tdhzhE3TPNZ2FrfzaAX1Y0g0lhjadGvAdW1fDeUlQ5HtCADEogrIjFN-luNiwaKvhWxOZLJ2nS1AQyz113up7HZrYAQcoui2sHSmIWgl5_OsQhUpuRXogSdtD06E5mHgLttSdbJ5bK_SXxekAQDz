!function(){try{(function(e){function t(e){this.attachNodes(e),this.attachEvents(),this.params=this.pickFromJson(e.getAttribute("onHiJJzno2uE"),"notifier"),this.nodes.el.setAttribute("aria-label","Нет новых уведомлений"),this._fetchCounter(),this.scopePopup()}t.prototype={nodes:{},attachNodes:function(t){this.nodes.el=t,this.nodes.close=t.querySelector(".notifier__close"),this.nodes.content=t.querySelector(".notifier__content"),this.nodes.icon=t.querySelector(".notifier__icon"),this.nodes.ticker=t.querySelector(".notifier__ticker"),this.nodes.popup=t.querySelector(".light-popup"),this.nodes.spin=t.querySelector(".spin2"),this.nodes.window=e},events:[{domNode:"el",event:"click",handler:"callShowIframe"},{domNode:"close",event:"click",handler:"closeIframe"},{domNode:"window",event:"popstate",handler:"_onUpdateState"},{domNode:"el",event:"keydown",handler:"_onKeyDown"}],_onKeyDown:function(e){27===e.keyCode&&this.closeIframe()},showIframe:function(){if(!this.opened)return this.nodes.popup&&this.nodes.popup.classList&&(this.nodes.popup.classList.add("light-popup_visible_yes"),e.document.body.classList.add("body-notifier-opened")),!this._dataLoaded&&this.nodes.spin&&this.nodes.spin.classList.add("spin2_progress_yes"),this.opened=!0,this.updatePopup(!1),!0},callShowIframe:function(e){this.initLoader(),this.showIframe(e)},closeIframe:function(){this.nodes.popup&&this.nodes.popup.classList&&(this.nodes.popup.classList.remove("light-popup_visible_yes"),e.document.body.classList.remove("body-notifier-opened")),this.opened=!1,this.updatePopup(!0)},initLoader:function(){this._iframeLoaded||(e.LegoIframeLoader?this._loadIframe():this._insertLoaderScript(this._loadIframe.bind(this)),this._iframeLoaded=!0)},_onUpdateState:function(t){var o=e.history.state||{};o.notifier&&"open"===o.notifier?(!this._iframeLoaded&&this.initLoader(),this.showIframe(t)):this.closeIframe(t)},attachEvents:function(){this.events.forEach(function(e){var t=e.domNode,o=e.event,i=e.handler;this.nodes[t]&&this.nodes[t].addEventListener(o,this[i].bind(this))}.bind(this))},detachEvents:function(){this.events.forEach(function(e){var t=e.domNode,o=e.event,i=e.handler;this.nodes[t]&&this.nodes[t].removeEventListener(o,this[i].bind(this))}.bind(this))},scopePopup:function(){},updatePopup:function(t){var o=e.history.state||{};t?(o.notifier&&"open"===o.notifier&&e.history.back(),this._firstOpen=!1):(this._firstOpen=!(void 0!==this._firstOpen)||void 0,!o.notifier&&e.history.pushState(Object.assign(o,{notifier:"open"}),null)),t||this.removeTicker(),this.nodes.el.setAttribute("aria-expanded",!t)},removeTicker:function(){this.nodes.el&&this.nodes.el.classList.remove("notifier_has-unread_yes"),this.nodes.el.setAttribute("aria-label","Нет новых уведомлений")},showTicker:function(e){this.nodes.el&&this.nodes.el.classList.add("notifier_has-unread_yes"),this.nodes.ticker.textContent=+e,this.nodes.el.setAttribute("aria-label","Новых уведомлений: "+ +e)},_fetchCounter:function(){var t=this.onUpdateCounter.bind(this),o=new e.XMLHttpRequest;o.open("GET",this._getCounterUrl(),!0),o.withCredentials=!0,o.onload=function(e){if(200===e.currentTarget.status){var o=this.pickFromJson(e.currentTarget.response),i=o&&o.unviewed_count&&o.services?this._convertToUint(o.unviewed_count):0;t(i)}}.bind(this),o.send()},_convertToUint:function(e){var t=+e||0;return 0<=t&&this._isInteger(t)?t:0},_isInteger:function(e){return(0^e)===e},toggleCloseIcon:function(e){this.nodes.close&&this.nodes.close.classList.toggle("notifier__close_visible_yes",e)},pickFromJson:function(e,t){var o={};try{o=JSON.parse(e)}catch(e){}return t&&o[t]?o[t]:o},_getTld:function(){var e=document.location.host.match(/^.*(\.\w+)$/);return e?e[1]:".ru"},_getHost:function(){return"https://"+(this.params.apiHost&&-1!==this.params.apiHost.indexOf("yandex-team")?"bell.yandex-team":"yandex")+this._getTld()},_getCounterUrl:function(){return this._getHost()+"/bell/api/v1/get-ticker"},_getLoaderUrl:function(){return this.params.loaderUrl||this.params.baseUrl+"/iframe-loader/"+this.params.olHacInH46elpsion+"/index.min.js"},_insertLoaderScript:function(t){var o=e.document.getElementsByTagName("head")[0]||e.document.getElementsByTagName("body")[0],i=e.document.createElement("script");i.setAttribute("src",this._getLoaderUrl()),o.insertBefore(i,o.lastChild),i.onload=t},_loadIframe:function(){var t={iframeUrl:this.params.iframeUrl,container:this.nodes.content};this.win=e,this._atom=new e.LegoIframeLoader(t),this._atom.on("init",function(e,t){this._onIframeLoad(t)}.bind(this)),this._atom.init()},_onIframeLoad:function(){this._dataLoaded=!0,this._hasLoaded=!0,this.nodes.popup&&this.nodes.popup.classList.add("notifier__popup_loaded_yes"),this.nodes.spin&&this.nodes.spin.classList.remove("spin2_progress_yes"),this.nodes.popup&&this.nodes.popup.classList.contains("light-popup_visible_yes")},params:{},onUpdateCounter:function(e){var t=Math.min(e,99);!this._firstOpen&&!!t&&this.showTicker(t),this._firstOpen&&(this._firstOpen=!1)}},e.Lego=e.Lego||{},e.Lego.NotifierClass=t})(window),function(e){(function(t){e.Lego.NotifierClass.prototype.showIframe=function(e){var o=t.apply(this,arguments);o&&(e.preventDefault(),e.stopPropagation(),this.addDocumentEvent(),this.addScrollEvent())}})(e.Lego.NotifierClass.prototype.showIframe),function(t){e.Lego.NotifierClass.prototype.closeIframe=function(){t.apply(this,arguments),e.removeEventListener("scroll",this.onWindowScrollBind)}}(e.Lego.NotifierClass.prototype.closeIframe),e.Lego.NotifierClass.prototype.onWindowScroll=function(){-10>this.nodes.popup.getBoundingClientRect().top&&this.closeIframe()},e.Lego.NotifierClass.prototype.addScrollEvent=function(){this.onWindowScrollBind=this.onWindowScroll.bind(this),e.addEventListener("scroll",this.onWindowScrollBind)},e.Lego.NotifierClass.prototype.onDocumentClick=function(e){this.nodes.popup.contains(e.target)||(this.removeDocumentEvent(),this.closeIframe())},e.Lego.NotifierClass.prototype.addDocumentEvent=function(){this.onDocumentClickBind=this.onDocumentClick.bind(this),e.addEventListener("click",this.onDocumentClickBind)},e.Lego.NotifierClass.prototype.removeDocumentEvent=function(){e.removeEventListener("click",this.onDocumentClickBind)};var t=e.document.querySelector(".notifier");t&&(e.LegoNotifier=new e.Lego.NotifierClass(t))}(window)}catch(e){console.error("notifier:"+e)}}();
